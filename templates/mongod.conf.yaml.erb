# !!! generated by puppet !!!
# mongod.conf - YAML Syntax

systemLog:
   destination: file
   path: <%= scope.lookupvar('mongodb::logdir') %>/mongod_<%= @mongod_instance %>.log
   logAppend: <%= @mongod_logappend %>

processManagement:
   fork: <%= @mongod_fork %>
   pidFilePath: <%= scope.lookupvar('mongodb::pidfilepath') %>/mongod_<%= @mongod_instance %>/mongod.pid

net:
   port: <%= @mongod_port %>
<%- if @mongod_bind_ip != "" -%>
   bindIp: <%= @mongod_bind_ip %>
<%- end -%>
<%- if @mongod_http != false -%>
   http:
      RESTInterfaceEnabled: <%= @mongod_rest %>
<%- end -%>

security:
<%- if @mongod_auth != false -%>
   keyFile: /etc/mongod_<%= @mongod_instance %>.key
   clusterAuthMode: keyFile
   authorization: enabled
<%- end -%>
<%- if @mongod_auth == false -%>
   authorization: disabled
<%- end -%>

storage:
   dbPath: <%= scope.lookupvar('mongodb::dbdir') %>/mongod_<%= @mongod_instance %>
   engine: <%= @mongod_engine %>

<%- if @mongod_replSet != "" -%>
replication:
   replSetName: <%= @mongod_replSet %>
<%- end -%>

<%- if @mongod_shardsvr != false -%>
sharding:
   clusterRole: <%= @mongod_shardsvr %>
<%- end -%>
<%- if @mongod_configsvr != false -%>
sharding:
   clusterRole: <%= @mongod_configsvr %>
<%- end -%>

<%- if @mongod_operation_profiling_slowms != "" or @mongod_operation_profiling_mode != "" -%>
operationProfiling:
<%- if @mongod_operation_profiling_slowms != "" -%>
   slowOpThresholdMs: <%= @mongod_operation_profiling_slowms %>
<%- end -%>
<%- if @mongod_operation_profiling_mode != "" -%>
   mode: <%= @mongod_operation_profiling_mode %>
<%- end -%>
<%- end -%>

<%- if !@mongod_add_options.empty? -%>
setParameter:
<%- @mongod_add_options.sort_by{|key, value| key}.each do |key,value| -%>
  <%= key %>: <%= value %>
<%- end -%>
<%- end -%>

